<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="ja" class="ie6 ielt10 ielt9 ielt8"> <![endif]-->
<!--[if IE 7 ]>    <html lang="ja" class="ie7 ielt10 ielt9 ielt8"> <![endif]-->
<!--[if IE 8 ]>    <html lang="ja" class="ie8 ielt10 ielt9"> <![endif]-->
<!--[if IE 9 ]>    <html lang="ja" class="ie9 ielt10"> <![endif]-->
<!--[if (gte IE 10)|!(IE)]><!-->
<!-- <html lang="ja">-->
<!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http:www.thymeleaf.org">

<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>管理者設定 | アンケートシステム</title>
<meta name="description" content="" />
<meta name="author" content="" />
<link rel="stylesheet" type="text/css" href="../css/sparkplug.css" />
<script type="text/javascript" src="../js/jquery-1.11.3.js"
	th:src="@{/js/jquery-1.11.3.js}"></script>
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
      <script src="../js/respond.min.js"></script>
    <![endif]-->
<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/
	//responseMappingの値を押したボタンによって変更するメソッド
	function methodLink(btnNo) {
		if (btnNo == 1) {//確認ボタンを押したときbtnNo=1
			$("#searchUserForm").attr('action', '/enquete/adminConclude');
			$("#searchUserForm").submit();
		} else if (btnNo == 2) {//確認ボタンを押したときbtnNo=2
			$("#searchUserForm").submit();
		}
	}
	//検索した事業部を取得し、selectedにするメソッド
	function searchForm() {
		var value = /*[[${enqueteAdminSearchUserForm.deptId}]]*/'999';
		if (value != null) {
			//検索で使用された事業部IDと同じvalueを持つoptionタグにselectedを追加する
			$("option[value=" + value + "]").attr("selected", "selected");
		}
	}
	
	//すべてのチェックボックスにチェックをつけるメソッド
	function allTd(bottunNum){
		if(bottunNum==1){
			//初めて押されたときは、すべてにチェックをつける
			var target = $("#adminTable input[type='checkbox']");
			target.prop('checked','checked');
			//次このボタンを押したときの引数を変更しておく
			$("#allAdminTable").attr("onclick","allTd(2)");
		}else if(bottunNum==2){
			//2回目に押されたときは、すべてのチェックをはずす
			var target = $("#adminTable input[type='checkbox']");
			target.removeAttr("checked");
			//次このボタンを押したときの引数を変更しておく
			$("#allAdminTable").attr("onclick","allTd(1)");
		}else if(bottunNum==3){
			//初めて押されたときは、すべてにチェックをつける
			var target = $("#nonAdminTable input[type='checkbox']");
			target.prop('checked','checked');
			//次このボタンを押したときの引数を変更しておく
			$("#allNonAdminTable").attr("onclick","allTd(4)");
		}else if(bottunNum==4){
			//2回目に押されたときは、すべてのチェックをはずす
			var target = $("#nonAdminTable input[type='checkbox']");
			target.removeAttr("checked");
			//次このボタンを押したときの引数を変更しておく
			$("#allNonAdminTable").attr("onclick","allTd(3)");
		}
	}
	//チェックがついた要素を削除するメソッド
	function remove() {
		//チェックがついている要素を削除
		var target = $("#adminTable input[type='checkbox']:checked").parent().parent().parent();
		target.remove();
	}
	//検索結果テーブルでチェックが付いた要素を管理者テーブルへ移動するメソッド
	function move() {
		//nonAdminTableの要素数の取得
		var size = $("#nonAdminTable input[type='checkbox']:checked").length;
		var flug = 0; //メッセージを表示するためのフラグ
		for(var i=0;i<size;i++){
			//チェックされた要素の取得
			var target = $("#nonAdminTable input[type='checkbox']:checked");
			//要素のname属性の取得
			var targetName = target.attr('name');
			//name属性が等しい要素を検索
			var checkAdmin = $("#adminTable input[name="+targetName+"]");
			//name属性が等しい要素を検索
			var uncheck = checkAdmin.attr("name");
			$("#nonAdminTable input[name="+uncheck+"]").removeAttr("checked");
			//検索結果テーブルでチェックされた要素を管理者テーブルへ移動
			if(uncheck==null){
			$("#nonAdminTable input[name="+targetName+"]").parent().parent().appendTo('table#adminTable');
			}else{
				flug = 1;
			}
		}
			if(flug==1){
				alert("重複したユーザーは管理者に追加できません");
			}
		//移動後にチェックを外す
		$("#adminTable input[type='checkbox']:checked").removeAttr("checked");
	}
	//enqueteAdminUserListForm内部のenqueteAdminUserListの中身を全て空で上書きするメソッド
	function removeFormList(){
		var listSize =/*[[${enqueteAdminUserListForm.enqueteAdminUserFormList.size()}]]*/ 0;
		for(var i=0;i<listSize;i++){
			//enqueteAdminUserFormListのesqIdにnullを突っ込む
			var div_element1 = document.createElement("div");
			div_element1.className = "nullElement";
		    div_element1.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].esqId" id="enqueteAdminUserFormList' + i + '.esqId" value="">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element1);
		  	//enqueteAdminUserFormListのuserNameにnullを突っ込む
			var div_element2 = document.createElement("div");
			div_element2.className = "nullElement";
		    div_element2.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].userName" id="enqueteAdminUserFormList' + i + '.userName" value="">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element2);
		  	//enqueteAdminUserFormListのuserNameにnullを突っ込む
			var div_element3 = document.createElement("div");
			div_element3.className = "nullElement";
		    div_element3.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].deptName" id="enqueteAdminUserFormList' + i + '.deptName" value="">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element3);
		}
		$(".nullElement").remove();
	}
	//テーブル（＃adminTable）の内容をenqueteAdminUserListFormに格納する
	function addFormList(){
		var size = $("#adminTable tr").length;
		for(i=0;i<size;i++){
			//テーブル（＃adminTable）のdeptNameを取得する
			var deptName = $(" #adminTable tr:eq("+i+") td span:eq(0)").text();
			//enqueteAdminUserFormListのdeptNameに値を突っ込む
			var div_element1 = document.createElement("div");
			div_element1.className = "element";
		    div_element1.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].deptName" id="enqueteAdminUserFormList' + i + '.deptName" value="'+deptName+'">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element1);
		    
		  	//テーブル（＃adminTable）のesqIdを取得する
			var esqId = $(" #adminTable tr:eq("+i+") td span:eq(1)").text();
			//enqueteAdminUserFormListのesqIdに値を突っ込む
			var div_element2 = document.createElement("div");
			div_element2.className = "element";
		    div_element2.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].esqId" id="enqueteAdminUserFormList' + i + '.esqId" value="'+esqId+'">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element2);
		    
		  //テーブル（＃adminTable）のuserNameを取得する
			var userName = $(" #adminTable tr:eq("+i+") td span:eq(2)").text();
			//enqueteAdminUserFormListのuserNameに値を突っ込む
			var div_element3 = document.createElement("div");
			div_element3.className = "element";
		    div_element3.innerHTML ='<input type="hidden" name="enqueteAdminUserFormList[' + i + '].userName" id="enqueteAdminUserFormList' + i + '.userName" value="'+userName+'">';
		    var object = document.getElementById("element");
		    object.appendChild(div_element3);
		}
	}
	//enqueteAdminUserListFormを空にし、テーブル（＃adminTable）の内容を格納する
	function formInsert(){
		removeFormList();
		addFormList();
	}
	//「この条件で検索」ボタンを押したときの処理
	function clickSearchBottun(){
		formInsert();
		methodLink(2);
	}
	//「確定」ボタンを押したときの処理
	function clickConfirmBottun(){
		formInsert();
		methodLink(1);
	}
	//作成者をチェック欄ではなく作成者と表示する（例として田中太郎を作成者とする）
	function creator(){
		//作成者の識別Id
		var creatorId = /*[[${enqueteCreateForm.enqueteForm.createUserId}]]*/"li9010";
		//name属性の値が識別idが同じ場合チェックボックスを消し「作成者」と表示する
		var target = $("#adminTable input[name="+creatorId+"]");
		target.parent().append('<td>作成者</td>');
		target.attr("class","hidden");
		target.attr("type","hidden");
	}
	//ページ読み込み時の処理をメソッド抽出する
	window.onload = function pageOnLoad(){
		creator();
		searchForm();
	}
	/*]]>*/
</script>
<style>
.btn {
	width: 100px;
}

#returnBottun {
	float: left;
}

#removeBottun {
	margin: 0 0 0 75%;
}
.hidden{
	display: none;
	visibility: hidden;
}
</style>
</head>

<body class="sp-with-navbar-subnav">

	<!-- header -->
	<div class="navbar navbar-inverse navbar-fixed-top sp-navbar"
		role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<a href="#" class="navbar-brand"> <i class="fa fa-cloud"></i> <b>アンケートシステム</b>
				</a>
			</div>
			<ul class="nav navbar-nav">
				<li><a th:href="@{/menu}">メニュー</a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown"><a href="#" role="button"
					class="dropdown-toggle" data-toggle="dropdown"
					aria-expanded="false"> <i class="fa fa-user"> </i>ESQID: <span
						th:text="${LOGINUSER.esqid}">AAA</span><span> </span> <span
						th:text="${LOGINUSER.username}">AAA</span> <b class="caret"></b></a></li>
				<li><a href="/logout">ログアウト</a></li>
			</ul>
		</div>
	</div>
	<!-- /header -->

<!-- 管理者リストユニット -->
	<div class="sp-fixed-sidenav"
		style="background-color: #ffffff; position: absolute; top: 40px; left: 70px;">
		<h2>管理者設定</h2>
	</div>
	<div class="sp-fixed-sidenav"
		style="background-color: #ffffff; position: absolute; top: 100px; left: 70px; width: 500px;">
		<div class="panel sp-panel-default">
			<div class="panel-heading" align="center">
				<h3 class="panel-title">管理者一覧</h3>
			</div>
			<table class="table table-striped table-condensed table-bordered">
				<thead>
					<tr>
						<th style="width: 71px;"><input id="allAdminTable"
							style="width: 60px; font-size: 12px;" type="button"
							class="btn btn-default" value="全選択"
							onclick="allTd(1); return false;" /></th>
						<th
							style="width: 160px; display: table-cell; vertical-align: middle;">事業部</th>
						<th style="display: table-cell; vertical-align: middle;">ESQID</th>
						<th
							style="width: 160px; display: table-cell; vertical-align: middle;">管理者</th>
					</tr>
				</thead>
			</table>
			<div style="overflow-y: scroll; height: 390px;">
				<table class="table table-striped table-condensed table-bordered" id="adminTable">
					<tbody>

						<div th:if="${enqueteAdminUserListForm.enqueteAdminUserFormList.size() == 0}">
							<tr th:each="userDeptDtoList:${enqueteManagementConfigVM.userDeptDtoList}">
								<td class="sp-va-m" style="width: 70px;"><div
										align="center">
										<input type="checkbox" th:name="${userDeptDtoList.esqId}"/>
									</div></td>
								<td class="sp-va-m" style="width: 160px;"><span 
									th:text="${userDeptDtoList.deptName}"></span></td>
								<td class="sp-va-m" style="width: 108px;"><span 
									th:text="${userDeptDtoList.esqId}"></span></td>
								<td class="sp-va-m"><span 
									th:text="${userDeptDtoList.userName}"></span></td>
							</tr>
						</div>

						<div th:unless="${enqueteAdminUserListForm.enqueteAdminUserFormList.size() == 0}">
							<tr th:each="enqueteAdminUserFormList:${enqueteAdminUserListForm.enqueteAdminUserFormList}">
								<td class="sp-va-m" style="width: 70px;"><div
										align="center">
										<input type="checkbox" th:name="${enqueteAdminUserFormList.esqId}"/>
									</div></td>
								<td class="sp-va-m" style="width: 160px;"><span 
									th:text="${enqueteAdminUserFormList.deptName}"></span></td>
								<td class="sp-va-m" style="width: 108px;"><span 
									th:text="${enqueteAdminUserFormList.esqId}"></span></td>
								<td class="sp-va-m"><span 
									th:text="${enqueteAdminUserFormList.userName}"></span></td>
							</tr>
						</div>
					</tbody>
				</table>
				<br />
			</div>
			<div class="panel-heading">
				<input type="button" class="btn btn-danger sp-w100" onclick="remove(); return false;"
					id="removeBottun" value="削除"/>
			</div>
		</div>
	</div>
<!-- /管理者リストユニット -->

<!-- 検索側のユニット -->
<!-- 検索用のフォーム -->
	<div class="sp-fixed-sidenav"
		style="position: absolute; top: 100px; left: 720px; width: 500px;">
		<!-- top: 150px; left: 680px; -->
		<div class="panel sp-panel-default" data-sp-toggle="panel">
			<div class="panel-heading" tabindex="0">
				<div class="row">
					<div class="col-xs-3">
						<h2 class="panel-title">
							<i class="fa fa-fw fa-caret-down"></i>&nbsp;絞り込み検索
						</h2>
					</div>
					<div class="col-xs-9 sp-ta-r sp-text-additional">
						<strong>条件 </strong>名前の指定内容／ESQIDの指定内容／事業部の指定内容
					</div>
				</div>
			</div>

			<div class="sp-iobox sp-iobox-h">
				<form th:action="@{/enquete/searchUser}" method="post"
					id="searchUserForm" th:object="${enqueteAdminSearchUserForm}">
					<!-- jsで使うための値をhiddenで保持する -->
					<div id="element"></div>
					
					<table class="table">
						<tbody>
							<tr>
								<th class="sp-iobox-label-area sp-label-container">
									<div class="sp-label-container">
										<label class="sp-text-secondary" for="textbox01">名前</label> <span
											class="label label-default"><small>任意</small></span>
									</div>
								</th>
								<td><input class="form-control" type="text" id="textbox01"
									th:value="${enqueteAdminSearchUserForm.userName}"
									name="userName" /></td>
							</tr>
							<tr>
								<th class="sp-iobox-label-area sp-label-container">
									<div class="sp-label-container">
										<label class="sp-text-secondary" for="textbox01">ESQID</label>
										<span class="label label-default"><small>任意</small></span>
									</div>
								</th>
								<td><input class="form-control" type="text" id="textbox01"
									th:value="${enqueteAdminSearchUserForm.esqId}" name="esqId" /></td>
							</tr>
							<tr>
								<th class="sp-iobox-label-area sp-label-container">
									<div class="sp-label-container">
										<label class="sp-text-secondary">事業部</label> <span
											class="label label-default"><small>任意</small></span>
									</div>
								</th>
								<td class="form-inline"><select class="form-control"
									name="deptId">
										<option selected="selected" value="0">――――――――――――――――――――</option>
										<div th:each="deptList:${SEARCHUSER.deptList}">
											<option th:value="${deptList.deptId}"
												th:text="${deptList.deptName}">2020テクノロジー＆ビジネス開発室</option>
										</div>
								</select></td>
							</tr>
						</tbody>
					</table>
					<div class="panel-heading" style="text-align: center;">
						<input type="button" class="btn btn-default sp-w250"
							value="この条件で検索" onclick="clickSearchBottun(); return false;" />
					</div>
				</form>

			</div>
			<div class="sp-fixed-sidenav"
				style="background-color: #ffffff; width: 100%;">
				<div class="panel sp-panel-default">
					<div class="panel-heading" align="center">
						<h3 class="panel-title">追加候補者一覧</h3>
					</div>
					<table class="table table-striped table-condensed table-bordered" >
						<thead>
							<tr>
								<th style="width: 71px;"><input id="allNonAdminTable"
									style="width: 60px; font-size: 12px;" type="button"
									class="btn btn-default" value="全選択"
									onclick="allTd(3); return false;" /></th>
								<th
									style="width: 160px; display: table-cell; vertical-align: middle;">事業部</th>
								<th style="display: table-cell; vertical-align: middle;">ESQID</th>
								<th
									style="width: 160px; display: table-cell; vertical-align: middle;">名前</th>
							</tr>
						</thead>
					</table>
					<!-- /検索用のフォーム -->
					<!-- 検索されたテーブル -->
					<div style="overflow-y: scroll; height: 180px;">
						<table class="table table-striped table-condensed table-bordered" id="nonAdminTable">
							<tbody>
								<div th:unless="${SEARCHUSER}==null">
									<tr th:each="userDeptDtoList:${SEARCHUSER.userDeptDtoList}">
										<td class="sp-va-m" style="width: 70px; text-align: center;">
										<input type="checkbox" th:name="${userDeptDtoList.esqId}" /></td>
										<td class="sp-va-m" style="width: 160px;"><span
											th:text="${userDeptDtoList.deptName}" ></span></td>
										<td class="sp-va-m" style="width: 106px;"><span
											th:text="${userDeptDtoList.esqId}" ></span></td>
										<td class="sp-va-m"><span
											th:text="${userDeptDtoList.userName}" ></span></td>
									</tr>
								</div>
							</tbody>
						</table>
						<br />

					</div>
					<div class="panel-heading">
						<b></b>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!-- /検索されたテーブル -->
	<!-- /検索側のユニット -->

	<div class="sp-fixed-sidenav"
		style="position: absolute; top: 300px; left: 597px; width: 10%;">
		<input type="button" class="btn btn-primary sp-w100" onclick="move(); return false;" value="←"/>
	</div>

	<div align="center"
		style="position: absolute; top: 640px; left: 530px;">

		<!-- 戻るボタン -->
		<form th:action="@{/enquete/config}" method="post" id="returnBottun">
			<div th:unless="${enqeteCreateForm==null}">
				<input type="hidden" th:name="enqueteId"
					th:value="${enqeteCreateForm.enqueteId}" />
			</div>
			<div th:if="${enqeteCreateForm==null}">
				<input type="hidden" th:name="enqueteId" th:value="0" />
			</div>
			<input type="submit" class="btn btn-default sp-m5" value="戻る" />
		</form>
		<!-- 確定ボタン -->
		<input type="button" class="btn btn-primary sp-m5" value="確定"
			onclick="clickConfirmBottun(); return false;" id="confirm" />
	</div>


	<script src="../js/jquery-1.11.3.js"></script>
	<script src="../js/bootstrap.js"></script>
	<script src="../js/sparkplug.js"></script>
	<script src="../js/jquery.placeholder.js"></script>


</body>
</html>
