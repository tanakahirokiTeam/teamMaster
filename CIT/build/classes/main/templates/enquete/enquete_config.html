<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="ja" class="ie6 ielt10 ielt9 ielt8"> <![endif]-->
<!--[if IE 7 ]>    <html lang="ja" class="ie7 ielt10 ielt9 ielt8"> <![endif]-->
<!--[if IE 8 ]>    <html lang="ja" class="ie8 ielt10 ielt9"> <![endif]-->
<!--[if IE 9 ]>    <html lang="ja" class="ie9 ielt10"> <![endif]-->
<!--[if (gte IE 10)|!(IE)]><!-->
<!--<html lang="ja">-->
<!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http:www.thymeleaf.org">

<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<meta name="description" content="" />
<meta name="author" content="" />
<link rel="stylesheet" type="text/css" href="../css/sparkplug.css"
		th:href="@{/css/sparkplug.css}" />
<link rel="stylesheet" type="text/css" href="../css/common.css" 
		th:href="@{/css/common.css}"/>
<link rel="stylesheet" type="text/css" href="../css/jquery-ui.css"
		th:href="@{/css/jquery-ui.css}" />
		
<title>アンケート作成|アンケートシステム</title>
		
<script type="text/javascript" src="../js/jquery-1.11.3.js" th:src="@{/js/jquery-1.11.3.js}"></script>
<script type="text/javascript" src="../js/jquery-ui.min.js" th:src="@{/js/jquery-ui.min.js}"></script>




<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="../static/js/html5shiv.min.js"></script>
      <script src="../static/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="sp-with-navbar">

	<div class="navbar navbar-inverse navbar-fixed-top sp-navbar"
		role="navigation">
		<div class="container-fluid1">
			<div class="navbar-header">
				<a href="#" class="navbar-brand">
					<i class="fa fa-cloud"></i> <b>アンケートシステム</b>
				</a>
			</div>
			
			<!-- /navbar-header -->
			<ul class="nav navbar-nav">
				<li><a href="/menu">メニュー</a></li>
			</ul>
			
			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
					<a role="button" 
						aria-expanded="false">
						<i class="fa fa-user"></i>ESQID: <span th:text="${LOGINUSER.esqid}">AAA</span>
						<span th:text="${LOGINUSER.username}">AAA</span>
					</a>
				</li>
				<li><a href="/index">ログアウト</a></li>
			</ul>
		</div>
	</div>
	
	<!-- formのactionのデフォルトは一時保存ボタンの遷移先 -->
	<form th:method="post" th:object="${enqueteCreateForm}" name="form1" th:action="@{/enquete/temp}">
		<div class="container-fluid" id="pagetop">
			<input th:unless="${EC.creatorDto.enqueteId == null}" type="hidden" id="enqueteId" name="enqueteId"
					th:value="${EC.creatorDto.enqueteId}" />
			<input th:if="${EC.creatorDto.enqueteId == null}" type="hidden" id="enqueteId" name="enqueteId"
					value="0" />
			<h2 th:if="${EC.creatorDto.enqueteId == 0 || EC.creatorDto.enqueteId == null}">アンケート新規作成</h2>
			<h2 th:unless="${EC.creatorDto.enqueteId == 0 || EC.creatorDto.enqueteId == null}">アンケート編集</h2>
			<br/>
			<p style="color:red" align="center">
				<span th:if="${#fields.hasErrors('enqueteForm.enqueteName')}"
					th:errors="*{enqueteForm.enqueteName}">EEE!</span>
				<span>　　　　　　　　　</span>
			</p>
			<p style="color:red" align="center" th:if="${#fields.hasErrors('enqueteDeptFormList')}">
				<span th:errors="*{enqueteDeptFormList}">EEE!</span>
				<span>　　　　 </span>
			</p>
			<p style="color:red" align="center"  th:if="${#fields.hasErrors('questionFormList[0].questionTypeId')}">
				<span th:errors="*{questionFormList[0].questionTypeId}">EEE!</span>
				<span>　　　　　　　</span>
			</p>
			<div th:each="question,sts : ${enqueteCreateForm.questionFormList}" align="center">
				<p style="color:red" th:if="${#fields.hasErrors('questionFormList['+ sts.index +'].questionText')}">
					<span th:errors="*{__${'questionFormList['+ sts.index +'].questionText'}__}">EEE!</span>
					<span th:text="${'【質問 ' + sts.count + '】'}">AA</span>		
				</p>
				<div th:each="choice,sts1 : ${'enqueteCreateForm.questionFormList[' + sts.index + '].choiceList'}">	
					<p style="color:red" th:if="${#fields.hasErrors('questionFormList['+ sts.index +'].choiceFormList['+ sts1.index +'].choiceText')}">	
						<span th:errors="*{__${'questionFormList['+ sts.index +'].choiceFormList['+ sts1.index +'].choiceText'}__}">EEE!</span>
						<span th:text="${'　　　　　　　【質問 ' + sts.count  + '】'}">AA</span>		
					</p>
				</div>
			</div>
<!-- 			<div th:if="${#fields.hasAnyErrors()}" align="center">					 -->
<!--  					<p th:each="err : ${#fields.allErrors()}" -->
<!--  						th:text="${'*'+err}"  -->
<!--  						style="color:red" -->
<!--  						class="errorMessage">AAA</p> -->
<!-- 			</div> -->

			<div class="sp-iobox sp-iobox-h">		
				<table class="table">				
					<!--アンケートタイトル -->
					<tr>
						<th class="sp-iobox-label-area">
							<div class="sp-label-container">
								<label class="sp-text-secondary" for="textbox01">アンケートタイトル</label>
							</div>
						</th>
						<td colspan="2">
							<input class="form-control" type="text" placeholder="タイトルを入力してください" id="enqueteForm.enqueteName"
									 name="enqueteForm.enqueteName" th:value="${EC.enqueteName}" th:errorClass="fieldError" />
						</td>
					</tr>
					
					
					<!--事業部リスト -->
					<tr>
						<th class="sp-iobox-label-area">
							<div class="sp-label-container">
								<label class="sp-text-secondary">対象事業部</label>
							</div>
						</th>
						<td colspan="2">
							<div class="checkbox"  th:each="dept,status : ${EC.deptList}">
								<label>		
									<!-- 事業部選択がなかった場合 -->
									<input type="checkbox" th:text="${dept.deptName}"
										th:id="${'enqueteDeptFormList' + status.index + '.deptId'}"
										th:name="${'enqueteDeptFormList['+status.index +'].deptId'}"
										th:value="${dept.deptId}" 
										class="checkList"/>  
								</label>
							</div>
							<div th:each="deptList, checked_status : ${EC.enqueteDeptDtoList}"
							     class="hiddenList">
							 	<!-- 事業部選択があった場合（再編集） -->
								<input type="hidden" class="deptLIST" th:value="${deptList.deptId}" />
							</div>
						</td>
					</tr>
					
					
					<!--作成者 -->
					<tr>
						<th class="sp-iobox-label-area">
							<div class="sp-label-container">
								<label class="sp-text-secondary">作成者</label>
							</div>
						</th>
						<td colspan="2" th:unless="${EC.creatorDto.userName == null}">
							<p th:text="${EC.creatorDto.userName}">山田 太郎</p>
							<input type="hidden" th:value="${EC.creatorDto.createUserId}"
							     id="enqueteForm.createUserId" th:name="enqueteForm.createUserId" />
						</td>
						<td colspan="2" th:if="${EC.creatorDto.userName == null}">
							<p th:text="${LOGINUSER.username}">山田 太郎</p>
							<input type="hidden" th:value="${LOGINUSER.esqid}"
							     id="enqueteForm.createUserId" th:name="enqueteForm.createUserId" />
						</td>
					</tr>
					
					
					<!--管理者 -->
					<!--管理者 -->
					<tr>
						<th class="sp-iobox-label-area">
							<div class="sp-label-container">
								<label class="sp-text-secondary" for="textbox02">管理者</label>
							</div>
						</th>
						
						<td>
							<!-- 再編集用-->
							<div th:unless="${enqueteCreateForm == null}">
							<div th:each="enqueteAdminUserForm:${enqueteCreateForm.enqueteAdminUserFormList}">	
								<span th:text="${enqueteAdminUserForm.userName}">山田 太郎</span>
							</div>
							</div>
							<!-- 新規作成用 -->
							<div th:if="${EC.enqueteName} == null">	
								<span th:text="${LOGINUSER.username}">山田 太郎</span>							
								<input type="hidden" id="enqueteAdminUserFormList0.esqId"
									name="enqueteAdminUserFormList[0].esqId" th:value="${LOGINUSER.esqid}" />
							</div>
						</td>
						<td class="form-inline">
							<input type="button" class="btn btn-primary sp-w100" value="管理者編集" onClick="link(4)"/>
						</td>
					</tr>
				</table>
				
				
	
			<div id="piyo1">

				<div th:each="question,status : ${EC.questionVMList}">
					<div th:switch="${question.questionDto.questionTypeId}">
	
	
						<!-- 択一選択フォームの追加(再編集) -->
						<div th:case="'1'">
							<div class="form-question" th:id="${'form_question[' +status.index+ ']'}"><div>
								<table class="table">		
									<tr>
										<th class="sp-iobox-label-area" rowspan="2">
											<div class="sp-label-container">
												<p class="sp-text-secondary questionNumber" th:text="${'質問' + status.count}">質問1</p>
											</div>
										</th>
					
										<td colspan="2">
											<h3>【択一選択】</h3>
											<input type="hidden" class="form-control" th:name="${'questionFormList['+ status.index +'].questionTypeId'}"
													th:id="${'questionFormList'+ status.index +'.questionTypeId'}" value="1"/>
											<select class="form-control" th:name="${'questionFormList['+ status.index +'].requireFlag'}"
														th:id="${'questionFormList'+ status.index +'.requireFlag'}" style="width: 200px">
												<option th:if="${question.questionDto.requireFlag == 1}" selected="selected" value="1">回答必須</option>
												<option th:if="${question.questionDto.requireFlag == 0}" value="1">回答必須</option>
												<option th:if="${question.questionDto.requireFlag == 0}" selected="selected" value="0">回答任意</option>
												<option th:if="${question.questionDto.requireFlag == 1}" value="0">回答任意</option>
											</select>
											<br/>
											<input type="hidden" class="form-control" 
													th:id="${'questionFormList'+ status.index +'.questionId'}"
													th:value="${question.questionDto.questionId}"
													th:name="${'questionFormList['+ status.index +'].questionId'}" placeholder=" " />
											
											<h4>　[質問文]</h4>
											<input class="form-control" type="text"
													th:id="${'questionFormList'+ status.index +'.questionText'}" placeholder="質問文を入力してください"
													th:name="${'questionFormList['+ status.index +'].questionText'}"
													th:value="${question.questionDto.questionText}" />
											<br/>
											
											<h4>　[補足説明]</h4>
											<textarea cols="30" rows="2" class="form-control"
													th:id="${'questionFormList'+ status.index +'.questionSubtext'}" 
													th:name="${'questionFormList['+ status.index +'].questionSubtext'}" 
													th:text="${question.questionDto.questionSubtext}" 
													placeholder="補足説明があれば入力してください">
											</textarea>
											<br/>
											<h4>　[選択肢]</h4>
										</td>
									</tr>
								</table>
								
								<div th:class="${'form-block' +status.count}"
										th:id="${'form_block[' +cho_status.index+ ']'}"
										th:each="choice,cho_status : ${question.choiceList}">
										
									<table class="table">	
										<tr class="detail">
											<th class="sp-iobox-label-area"></th>
											<td>
												<input type="hidden" class="form-control" placeholder=" "
														th:id="${'questionFormList'+ status.index +'.choiceFormList'+ cho_status.index +'.choiceId'}"
														th:name="${'questionFormList['+ status.index +'].choiceFormList['+ cho_status.index +'].choiceId'}"
														th:value="${choice.choiceId}" />
																	
												<input class="form-control" type="text" placeholder="回答選択肢1"
														th:name="${'questionFormList['+ status.index +'].choiceFormList['+ cho_status.index +'].choiceText'}"
														th:id="${'questionFormList'+ status.index +'.choiceFormList'+ cho_status.index +'.choiceText'}"
														th:value="${choice.choiceText}" />
												<br/>
											</td>
											<td>
												<a th:if="${cho_status.index == 0}" role="button"
													class="btn btn-danger sp-w100 delete clo" style="display: none;">×</a>
												<a th:unless="${cho_status.index == 0}" role="button"
													class="btn btn-danger sp-w100 delete clo">×</a>
												<br/>
											</td>
										</tr>
									</table>
								</div>
												
									<table class="table">
										<tr>
											<th class="sp-iobox-label-area"></th>
											<td>
												<div class="btn-group margincenter form-block">
												<input type="button" class="btn btn-primary sp-w100 add"
														th:name="${'form-block' +status.count}" value="+" />
												<input type="hidden" class="className" th:value="${'form-block' +status.count}" />
												<input type="hidden" class="num" th:value="${question.choiceList.size()-1}" />
												</div>
											</td>
											<td>
												<div class="btn-group marginrighter">
													<a role="button" class="btn btn-danger sp-w100 del">質問削除</a>
												</div>
											</td>
										</tr>	
									</table>
							  </div></div>
						</div>	
						
						
						
					
						<div th:case="'2'"><!-- 複数選択フォームの追加	 -->
							<div class="form-question" th:id="${'form_question[' +status.index+ ']'}"><div>
							<table class="table">
								<tr>
									<th class="sp-iobox-label-area" rowspan="2">
										<div class="sp-label-container">
											<p class="sp-text-secondary questionNumber" th:text="${'質問' + status.count}">質問1</p>
										</div>
									</th>
									<td colspan="2">
										<h3>【複数選択】</h3>
										<input type="hidden" class="form-control" th:name="${'questionFormList['+ status.index +'].questionTypeId'}"
													th:id="${'questionFormList'+ status.index +'.questionTypeId'}" value="2"/>
										<select class="form-control" th:name="${'questionFormList['+ status.index +'].requireFlag'}"
												id="${'questionFormList'+ status.index +'.requireFlag'}" style="width: 200px">
											<option th:if="${question.questionDto.requireFlag == 1}" selected="selected" value="1">回答必須</option>
											<option th:if="${question.questionDto.requireFlag == 0}" value="1">回答必須</option>
											<option th:if="${question.questionDto.requireFlag == 0}" selected="selected" value="0">回答任意</option>
											<option th:if="${question.questionDto.requireFlag == 1}" value="0">回答任意</option>
										</select><br/>
										<input type="hidden" class="form-control" th:id="${'questionFormList'+ status.index +'.questionId'}" th:value="${question.questionDto.questionId}"
													th:name="${'questionFormList['+ status.index +'].questionId'}" placeholder=" " />
										
										<h4>　[質問文]</h4>
										<input class="form-control" type="text" th:id="${'questionFormList'+ status.index +'.questionText'}" placeholder="質問文を入力してください"
														th:name="${'questionFormList['+ status.index +'].questionText'}" th:value="${question.questionDto.questionText}" /><br/>
										
										<h4>　[補足説明]</h4>
										<textarea cols="30" rows="2" class="form-control"
													th:id="${'questionFormList'+ status.index +'.questionSubtext'}" 
													th:name="${'questionFormList['+ status.index +'].questionSubtext'}"
													th:text="${question.questionDto.questionSubtext}"
													placeholder="補足説明があれば入力してください">
										</textarea><br/>
										
										<h4>　[選択肢]</h4>
									</td>
								</tr>
							</table>
						
							<div th:class="${'form-block' +status.count}" th:id="${'form_block[' +cho_status.index+ ']'}" th:each="choice,cho_status : ${question.choiceList}">
								<table class="table">
								
									<tr class="detail">
									<th class="sp-iobox-label-area"></th>
									<td>
										<input type="hidden" class="form-control" placeholder=" " th:id="${'questionFormList'+ status.index +'.choiceFormList'+ cho_status.index +'.choiceId'}"
														th:name="${'questionFormList['+ status.index +'].choiceFormList['+ cho_status.index +'].choiceId'}" th:value="${choice.choiceId}" />			
										<input class="form-control" type="text" placeholder="回答選択肢1"  th:name="${'questionFormList['+ status.index +'].choiceFormList['+ cho_status.index +'].choiceText'}"
																th:id="${'questionFormList'+ status.index +'.choiceFormList'+ cho_status.index +'.choiceText'}" th:value="${choice.choiceText}" /><br/>
									</td>
									<td>
										<a th:if="${cho_status.index == 0}" role="button" class="btn btn-danger sp-w100 delete clo" style="display: none;">×</a>
										<a th:unless="${cho_status.index == 0}" role="button" class="btn btn-danger sp-w100 delete clo">×</a>
									</td>
									</tr>
								</table>
							</div>
						
								<table class="table">
									<tr>
										<th class="sp-iobox-label-area"></th>
										<td>
											<div class="btn-group margincenter form-block">
											<input type="button" class="btn btn-primary sp-w100 add" value="+" th:name="${'form-block' +status.count}" />
											<input type="hidden" class="num" th:value="${question.choiceList.size()-1}" />
											<input type="hidden" class="className" th:value="${'form-block' +status.count}" />
											</div>
										</td>
										<td>
											<div class="btn-group marginrighter">
												<a role="button" class="btn btn-danger sp-w100 del">質問削除</a>
											</div>
										</td>
									</tr>	
								</table>
							</div></div>
						</div>
						
						
						
						
						
						<div th:case="'3'"><!-- 自由記述フォームの追加 -->
							<div class="form-question" th:id="${'form_question[' +status.index+ ']'}">
								<table class="table">				
									<tr>
										<th class="sp-iobox-label-area" rowspan="2">
											<div class="sp-label-container">
												<p class="sp-text-secondary questionNumber" th:text="${'質問' + status.count}">質問1</p>
											</div>
										</th>
										<td colspan="2">
											<h3>【自由記述】</h3>
											<input type="hidden" class="form-control" th:name="${'questionFormList['+ status.index +'].questionTypeId'}"
													th:id="${'questionFormList'+ status.index +'.questionTypeId'}" value="3"/>
											<select class="form-control" th:name="${'questionFormList['+ status.index +'].requireFlag'}"
														th:id="${'questionFormList'+ status.index +'.requireFlag'}" style="width: 200px">
												<option th:if="${question.questionDto.requireFlag == 1}" selected="selected" value="1">回答必須</option>
												<option th:if="${question.questionDto.requireFlag == 0}" value="1">回答必須</option>
												<option th:if="${question.questionDto.requireFlag == 0}" selected="selected" value="0">回答任意</option>
												<option th:if="${question.questionDto.requireFlag == 1}" value="0">回答任意</option>
											</select><br/>
											
											<h4>　[質問文]</h4>
											<input type="hidden" class="form-control" th:id="${'questionFormList'+ status.index +'.questionId'}" th:value="${question.questionDto.questionId}"
													th:name="${'questionFormList['+ status.index +'].questionId'}" placeholder=" " />
											<input class="form-control" type="text" th:id="${'questionFormList'+ status.index +'.questionText'}" placeholder="質問文を入力してください"
															th:name="${'questionFormList['+ status.index +'].questionText'}" th:value="${question.questionDto.questionText}" /><br/>
											
											<h4>　[補足説明]</h4>
											<textarea cols="30" rows="2" class="form-control"
														th:id="${'questionFormList'+ status.index +'.questionSubtext'}" 
														th:name="${'questionFormList['+ status.index +'].questionSubtext'}"
														th:text="${question.questionDto.questionSubtext}" 
														placeholder="補足説明があれば入力してください"></textarea><br/>
										</td>
									</tr>
									<tr>
										<td></td>
										<td>
											<div class="btn-group marginrighter">
												<a role="button" class="btn btn-danger sp-w100 del">質問削除</a>
											</div>
										</td>
									</tr>
								</table>
							</div>	
						</div>
					</div>
				</div>
			
			
				<!-- 新規作成時のデフォルトの設問表示（択一選択） -->
				<div class="form-question" id="form_question[0]" th:if="${EC.questionVMList.size() == 0}">
				<div>
				<table class="table">		
					<tr>
						<th class="sp-iobox-label-area" rowspan="2">
							<div class="sp-label-container">
								<label class="sp-text-secondary" for="textbox01">質問1</label>
							</div>
						</th>
	
						<td colspan="2">
							<h3>【択一選択】</h3>
							<input type="hidden" class="form-control" name="questionFormList[0].questionTypeId" id="questionFormList0.questionTypeId" value="1"/>
							<select class="form-control" name="questionFormList[0].requireFlag" id="questionFormList0.requireFlag" style="width: 200px">
								<option selected="selected" value="1">回答必須</option>
								<option value="0">回答任意</option>
							</select><br/>
							<h4>　[質問文]</h4>
							<input class="form-control" type="text"
							placeholder="質問文を入力してください" th:field="*{questionFormList[0].questionText}" name="questionFormList0.questionText"/><br/>
							<h4>　[補足説明]</h4>
							<textarea cols="30" rows="2" class="form-control" th:field="*{questionFormList[0].questionSubtext}" name="questionFormList0.questionSubtext"
								placeholder="補足説明があれば入力してください"></textarea><br/>
							<h4>　[選択肢]</h4>	
						</td>
					</tr>
					</table>
					<div class="form-block1" id="form_block[0]">
						<table class="table">
						
						<tr class="detail">
							<th class="sp-iobox-label-area"></th>
							<td>
			
								<input class="form-control" type="text" placeholder="回答選択肢1"  name="questionFormList[0].choiceFormList[0].choiceText"
											id="questionFormList0.choiceFormList0.choiceText" /><br/>
							</td>
							<td>
								<a role="button" class="btn btn-danger sp-w100 delete clo" style="display: none;">×</a><br/>
								
							</td>
						</tr>
						</table>
					</div>				
					<table class="table">
						<tr>
						<th class="sp-iobox-label-area"></th>
						<td>
							<div class="btn-group margincenter form-block">
							<input type="button" class="btn btn-primary sp-w100 add" name="form-block1" value="+" />
							<input type="hidden" class="num" value="0" />
							<input type="hidden" class="className" value="form-block1" />
							</div>
						</td>
						<td>
							<div class="btn-group marginrighter">
								<a role="button" class="btn btn-danger sp-w100 del">質問削除</a>
							</div>
						</td>
						</tr>	
					</table>
				  </div>
				</div>
				
				
				
				
				
			</div>
			
			</div><br/>
			
			<div class="form-block" id="form_add">
				<div class="sp-iobox sp-iobox-h">		
				<table class="table">		
						<tr>
							<th class="sp-iobox-label-area">
								<div class="sp-label-container">
									<label class="sp-text-secondary">回答方法</label>
								</div>
							</th>
							<td><label class="radio-inline">
									<input type="radio" name="radio1" checked="checked" /> 自由記述
								</label> 
								<label class="radio-inline">
									<input type="radio" name="radio1" /> 択一選択
								</label> 
								<label class="radio-inline">
									<input type="radio" name="radio1" /> 複数選択
								</label>
							</td>
							<td>
								<a role="button" class="btn btn-primary sp-w100" onclick="add();">質問追加</a>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div><!-- /sp-maincontent -->		
		<br/>

		<br />
			<div  align="center">
			<input type="button" class="btn btn-default sp-m5" value="メニューへ戻る" onClick="link(1)"/>
			<input type="button" class="btn btn-default sp-m5" value="一時保存" onClick="link(2)"/>
        	<input type="button" class="btn btn-primary sp-m5" value="確認" onClick="link(3)"/>
			</div>
		<br/><br/>
	</form>

</body>

<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/
	var question = /*[[${EC.questionVMList.size()}]]*/ '999' ;
	if(question == 0) question = 1;
	var choice_num = question+1;

	var chack_obj = $('div#piyo1>div>div');
	if($(chack_obj).children().length == 0){
		$('div#piyo1>div').remove();
		question = 0;
		choice_num = 1;
	}

	//事業部リストのチェックへの対応	
	$('.hiddenList > .deptLIST').each(function(index1, Obj_1) {
		$('.checkbox > label > input').each(function(index2, Obj_2) {
			if($(Obj_1).val() ==  $(Obj_2).val() ){
				$(Obj_2).prop("checked", "checked");
			}			
		});	
	});
	
$(function () {
    var frm_cnt = 0;
    
    $(document).on('click', '.add', function(){
	  var className = $(this).attr('name');
	  frm_cnt = $(this).parent().find('.num').val();
      var original = $('#form_block\\[' + frm_cnt + '\\].' + className);
      var originCnt = frm_cnt;
      
      frm_cnt++;
      
      original
          .clone()
          .hide()
          .insertAfter(original)
          .attr('id', 'form_block[' + frm_cnt + ']') // クローンのid属性を変更。
          //.attr('id', 'questionFormList' + frm_cnt + '.questionTypeId')//
          .find("input[type='radio'][checked]").prop('checked', true)
          .end() // 一度適用する
          .find('input, textarea, select').each(function(idx, obj) {
              $(obj).attr({
                  id: $(obj).attr('id').replace(/choiceFormList[0-9]+/, 'choiceFormList' + frm_cnt ),
                  name: $(obj).attr('name').replace(/choiceFormList\[[0-9]\]+/, 'choiceFormList[' + frm_cnt + ']'),
                  placeholder: $(obj).attr('placeholder').replace(/[0-9]+/, frm_cnt+1 ) 
              });
              if ($(obj).attr('type') == 'text') {
                $(obj).val('');
              }
          }
          );

      // clone取得
      var clone = $('#form_block\\[' + frm_cnt + '\\]');
      clone.find("input[type='hidden']").remove();
      clone.find('input.form-control').attr('value', '');
      clone.find('a.clo').show();
      clone.slideDown('fast');
      
      $(this).parent().find('.num').val(frm_cnt);
	  });

    $(document).on('click', '.delete', function(){
        var removeObj = $(this).parent().parent().parent().parent().parent();
      	
        //先に番号減らす。
        var number = $(this).parent().parent().parent().parent().parent().parent().find('.num').val();
        
        $(removeObj).find('input').attr('id').replace(/choiceFormList[0-9]+/, 'choiceFormList' + 555 );
        $(removeObj).find('input').attr('name').replace(/choiceFormList\[[0-9]\]+/, 'choiceFormList[' + 555 + ']');
        $(removeObj).find('input').val(' ');
        console.log(removeObj);
        
       number--;
        $(this).parent().parent().parent().parent().parent().parent().find('.num').val(number);
        var className = $(this).parent().parent().parent().parent().parent().parent().find('.className').val();
        
        removeObj.fadeOut('fast', function() {
            removeObj.remove();
            // 番号振り直しを先にする！！
            var classNum = frm_cnt;
           	frm_cnt = 0;
            $("." + className + "[id^='form_block']").each(function(index, formObj) {
            	if ($(formObj).attr('id') != 'form_block[0]') {
                    frm_cnt++;
                    $(formObj)
                        .attr('id', 'form_block[' + frm_cnt + ']') // id属性を変更。
                        .find('input, textarea').each(function(idx, obj) {
                        	$(obj).attr({
                            	id: $(obj).attr('id').replace(/choiceFormList[0-9]+/, 'choiceFormList' + frm_cnt ),
                            	name: $(obj).attr('name').replace(/choiceFormList\[[0-9]\]+/, 'choiceFormList[' + frm_cnt + ']'),
                            	placeholder: $(obj).attr('placeholder').replace(/[0-9]+/, frm_cnt+1 ) 
                            });
                        });
                    
                    }
            	
            });
		    });
    });
    
    //設問削除
    $(document).on('click', '.del', function(){
	    var removeObj = $(this).parent().parent().parent().parent().parent().parent().parent();
	    var nullObj = $('div#piyo1>div:last').clone();
	    removeObj.fadeOut('fast', function() {
	        removeObj.remove();
	        frm_cnt = 0;
	        
	        $(".form-question[id^='form_question']").each(function(index, formObj) {
                    $(formObj)
                        .attr('id', 'form_question[' + frm_cnt + ']') // id属性を変更。  
                        .find('input.form-control, textarea, select').each(function(idx, obj) {
                        	$(obj).attr({
                           	    id: $(obj).attr('id').replace(/questionFormList[0-9]+/, 'questionFormList' + frm_cnt ),
                            	name: $(obj).attr('name').replace(/questionFormList\[[0-9]\]+/, 'questionFormList[' + frm_cnt + ']')
                            	
                            });
                        });
                    $(formObj).find('.questionNumber').html('<p class="sp-text-secondary questionNumber">質問' + (frm_cnt+1) + '</p>');
                    $(formObj).find('input.add').attr('name', 'form-block' + (frm_cnt+1));
                    $(formObj).find('input.className').val('form-block' + (frm_cnt+1));
                    $(formObj).children().children('div').attr('class', 'form-block' + (frm_cnt+1));
	
                   frm_cnt++;          
            });
	        
	    });
	    if(question > 0)question--;
	    $(nullObj)
		    .find('input.form-control, textarea, option').each(function(idx, obj) {
		    	$(obj).val('　');	        	
	   		 });
	    
	    if($(nullObj).find('input.form-control:first').attr('name') =='questionFormList[0].questionTypeId'){
	    	$(nullObj)
		    .find('input.form-control, textarea').each(function(idx, obj) {
		    	$(obj).val('　');        	
	   		 });
	    	$(nullObj).find('input.form-control:first').val('0');
	    	question--;
	    	choice_num--;
		    $('div#piyo1>div:last').after($(nullObj));
		    $('div#piyo1>div:last').hide();
	    }
	    else{
	    	$('div#piyo1>div:last').after($(nullObj));
	 		$('div#piyo1>div:last').remove();
	    }

	});
    
    $(document).on('click', '.checkList', function(){
    	if($(this).prop('checked') == false){
    		var del = $(this).clone();
    		$(del).val('');
    		$(del).attr('type', 'hidden');
    		$(this).parent().after($(del));
//     		$(this).parent().parent().find('input:last').remove();
    	}
    });
});


function add()
{
	radio = document.getElementsByName('radio1');
	if(question == -1){
		$('div#piyo1>div').remove()
		question++;
	}
	if(radio[1].checked) {
	    var div_element = document.createElement("div");
	    div_element.className = "form-question";
	    div_element.id = "form_question[" + question + "]";
		div_element.innerHTML = '<div><table class="table"><tr><th class="sp-iobox-label-area" rowspan="2"><div class="sp-label-container"><p class="sp-text-secondary questionNumber">質問' + (question+1) +'</p></div></th><td colspan="2"><h3>【択一選択】</h3><input type="hidden" class="form-control" name="questionFormList['+ question +'].questionTypeId" id="questionFormList'+ question +'.questionTypeId" value="1"/><select class="form-control" name="questionFormList['+ question +'].requireFlag" id="questionFormList'+ question +'.requireFlag" style="width: 200px"><option selected="selected" value="1">回答必須</option><option value="0">回答任意</option></select><br/><h4>　[質問文]</h4><input class="form-control" type="text" placeholder="質問文を入力してください" name="questionFormList['+ question +'].questionText" id="questionFormList'+ question +'.questionText"/><br/><h4>　[補足説明]</h4><textarea cols="30" rows="2" class="form-control" name="questionFormList['+ question +'].questionSubtext" id="questionFormList'+ question +'.questionSubtext" placeholder="補足説明があれば入力してください"></textarea><br/><h4>　[選択肢]</h4></td></tr></table><div class="form-block'+ choice_num +'" id="form_block[0]"><table class="table"><tr class="detail"><th class="sp-iobox-label-area"></th><td><input class="form-control" type="text" placeholder="回答選択肢1"  name="questionFormList['+ question +'].choiceFormList[0].choiceText" id="questionFormList'+ question +'.choiceFormList0.choiceText" /><br/></td><td><a role="button" class="btn btn-danger sp-w100 delete clo" style="display: none;">×</a><br/></td></tr></table></div><table class="table"><tr><th class="sp-iobox-label-area"></th><td><div class="btn-group margincenter form-block"><input type="button" class="btn btn-primary sp-w100 add" name="form-block'+ choice_num +'" value="+" /><input type="hidden" class="num" value="0" /><input type="hidden" class="className" value="form-block'+ choice_num +'" /></div></td><td><div class="btn-group marginrighter"><a role="button" class="btn btn-danger sp-w100 del">質問削除</a></div></td></tr></table>  </div>';
		var parent_object = document.getElementById("piyo1");
	    parent_object.appendChild(div_element);
	    choice_num++;
	    question++;
	}else if(radio[2].checked) {
		var div_element1 = document.createElement("div");
		div_element1.className = "form-question";
	    div_element1.id = "form_question[" + question + "]";
	    div_element1.innerHTML = '<div><table class="table"><tr><th class="sp-iobox-label-area" rowspan="2"><div class="sp-label-container"><p class="sp-text-secondary questionNumber">質問' + (question+1) + '</p></div></th><td colspan="2"><h3>【複数選択】</h3><input type="hidden" class="form-control" name="questionFormList['+ question +'].questionTypeId" id="questionFormList'+ question +'.questionTypeId" value="2"/><select class="form-control" name="questionFormList['+ question +'].requireFlag" id="questionFormList'+ question +'.requireFlag" style="width: 200px"><option value="1">回答必須</option><option selected="selected" value="0">回答任意</option></select><br/><h4>　[質問文]</h4><input class="form-control" type="text" placeholder="質問文を入力してください" name="questionFormList['+ question +'].questionText" id="questionFormList'+ question +'.questionText" /><br/><h4>　[補足説明]</h4><textarea cols="30" rows="2" class="form-control" name="questionFormList['+ question +'].questionSubtext" id="questionFormList'+ question +'.questionSubtext" placeholder="補足説明があれば入力してください"></textarea><br/><h4>　[選択肢]</h4></td></tr></table><div class="form-block' +choice_num + '" id="form_block[0]"><table class="table"><tr class="detail"><th class="sp-iobox-label-area"></th><td><input class="form-control" type="text" placeholder="回答選択肢1" name="questionFormList['+ question +'].choiceFormList[0].choiceText" id="questionFormList'+ question +'.choiceFormList0.choiceText" /><br/></td><td><a role="button" class="btn btn-danger sp-w100 delete clo" style="display: none;">×</a><br/></td></tr></table></div><table class="table"><tr><th class="sp-iobox-label-area"></th><td><div class="btn-group margincenter form-block"><input type="button" class="btn btn-primary sp-w100 add" value="+" name="form-block' +choice_num + '" /><input type="hidden" class="num" value="0" /><input type="hidden" class="className" value="form-block'+ choice_num +'" /></div></td><td><div class="btn-group marginrighter"><a role="button" class="btn btn-danger sp-w100 del">質問削除</a></div></td></tr></table></div>';
	    var parent_object = document.getElementById("piyo1");
	    parent_object.appendChild(div_element1);
	    choice_num++;
	    question++;
	}else if(radio[0].checked) {
		var div_element2 = document.createElement("div");
		div_element2.className = "form-question";
	    div_element2.id = "form_question[" + question + "]";
		div_element2.innerHTML = '<div><table class="table"><tr><th class="sp-iobox-label-area" rowspan="2"><div class="sp-label-container"><p class="sp-text-secondary questionNumber">質問' + (question+1) + '</p></div></th><td colspan="2"><h3>【自由記述】</h3><input type="hidden" class="form-control" name="questionFormList['+ question +'].questionTypeId" id="questionFormList'+ question +'.questionTypeId" value="3"/><select class="form-control" name="questionFormList['+ question +'].requireFlag" id="questionFormList'+ question +'.requireFlag" style="width: 200px"><option selected="selected" value="1">回答必須</option><option value="0">回答任意</option></select><br/><h4>　[質問文]</h4><input class="form-control" type="text" placeholder="質問文を入力してください" name="questionFormList['+ question +'].questionText" id="questionFormList'+ question +'.questionText"/><br/><h4>　[補足説明]</h4><textarea cols="30" rows="2" class="form-control" name="questionFormList['+ question +'].questionSubtext" id="questionFormList'+ question +'.questionSubtext" placeholder="補足説明があれば入力してください"></textarea><br/></td></tr></table><table class="table"><tr><th class="sp-iobox-label-area"></th><td></td><td><div class="btn-group marginrighter"><a role="button" class="btn btn-danger sp-w100 del">質問削除</a></div></td></tr></table></div>';
	    var parent_object = document.getElementById("piyo1");
	    parent_object.appendChild(div_element2);
	    question++;
	}
}
/*]]>*/

function link(btnNo){
	if (btnNo == 1){//戻るボタン
		location.href = "/menu";  
    
	}else if(btnNo == 2){//一時保存ボタン
		document.form1.submit();
	
	}else if(btnNo == 3){//確認ボタン
		$('form').attr('action','/enquete/confirm');//ここを書き換える！！！
		document.form1.submit();
  	}else if(btnNo == 4){//管理者編集ボタン
		$('form').attr('action','/enquete/manager');//ここを書き換える！！！
		document.form1.submit();
  	}
}

</script>
</html>